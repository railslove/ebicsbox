#!/bin/bash

bin/migrate

if [ "$1" = "server" ]; then
  /usr/local/bundle/bin/bundle exec puma config.ru -p $PORT
fi

if [ "$1" = "clock" ]; then
  /usr/local/bundle/bin/bundle exec clockwork lib/epics/scheduler/scheduler.rb
fi

if [ "$1" = "worker" ]; then
  /usr/local/bin/ruby bin/worker
fi

if [ "$1" = "all" ]; then
  nohup /usr/local/bundle/bin/bundle exec clockwork lib/epics/scheduler/scheduler.rb &
  nohup /usr/local/bin/ruby bin/worker &
  /usr/local/bundle/bin/bundle exec puma config.ru -p $PORT
fi
exit 1
