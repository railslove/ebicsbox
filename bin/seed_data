#!/usr/bin/env ruby

require 'bundler'
Bundler.setup(:default, :development)

require 'sequel'
require './config/configuration'

DB = Sequel.connect(Box::Configuration.new.database_url)

require './box/models/user'
require './box/models/organization'
require './box/models/account'
require './box/models/transaction'

organization = Box::Organization.new(
  name: "Musterfirma", 
  webhook_token: "9e7756bb7d52709c18c0de6ba9b1f298"
  )

puts "Organization created: " + organization.save.valid?.to_s

user = Box::User.new(
  name: "Meister Mustermann", 
  organization_id: organization.id, 
  access_token: "83ea13d542b3249c3edd2c79d2943ee7", 
  admin: true)

puts "User created: " + user.save.valid?.to_s

account = Box::Account.new(
  iban: "DE89370400440532013000", 
  bic: "KFDMBANKXYZ", 
  creditor_identifier: "DE98ZZZ09999999999", 
  name: "FakeAccount",
  url: "http://localhost:8080",
  host: "EBIXHOST",
  bankname: "FakeBank",
  organization_id: organization.id,
  balance_in_cents: "5300237",
  balance_date: DateTime.now)

puts "Account created: " + account.save.valid?.to_s

subscriber = Box::Subscriber.new(
  account_id: account.id,
  user_id: user.id,
  activated_at: DateTime.now)

puts 'Subscriber created: ' + subscriber.save.valid?.to_s

status = %w(file_upload es_verification)
type = %w(credit debit order_hac_final_pos order_hac_final_neg funds_credited funds_debited funds_charged_back)

15.times do    
  transaction = Box::Transaction.new(
    type: type[rand(type.length)],
    ebics_order_id: rand.to_s[2..4],
    ebics_transaction_id: rand.to_s[2..4],
    status: status[rand(status.length)],
    account_id: account.id,
    amount: rand.to_s[2..6],
    user_id: user.id)

  puts "Credit Transaction created: " + transaction.save.valid?.to_s
end
